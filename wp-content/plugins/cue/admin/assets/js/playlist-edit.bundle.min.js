!function(t){function e(o){if(i[o])return i[o].exports;var s=i[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,o){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=14)}([function(t,e){t.exports=wp},function(t,e){t.exports=_},function(t,e,i){"use strict";(function(e){function o(){var t={};s.extend(this,{controller:{},l10n:{},model:{},view:{}}),this.settings=function(e){return e&&s.extend(t,e),t.l10n&&(this.l10n=s.extend(this.l10n,t.l10n),delete t.l10n),t||{}}}var s=i(1);e.cue=e.cue||new o,t.exports=e.cue}).call(e,i(6))},function(t,e){t.exports=jQuery},function(t,e){t.exports=Backbone},function(t,e,i){"use strict";var o,s=i(1),n=i(2),r=i(2).l10n,a=i(8),l=i(0),c=l.media.model.Attachment;o={frames:[],model:{},setModel:function(t){return this.model=t,this},get:function(t){var e="_"+t,i=this.frames[e]||null;return i=this[e].call(this,i),this.frames[e]=i,i},_addTracks:function(t){return t||(t=new a({title:r.workflows.addTracks.frameTitle,library:{type:"audio"},button:{text:r.workflows.addTracks.frameButtonText},multiple:"add"}),t.uploader.options.uploader.plupload={filters:{mime_types:[{title:r.workflows.addTracks.fileTypes,extensions:"m4a,mp3,ogg,wma"}]}},t.state("embed").props.off("change:url",t.state("embed").debouncedScan),t.state("insert").on("insert",function(t){s.each(t.models,function(t){n.tracks.push(t.toJSON().cue)})}),t.state("embed").on("select",function(){var t=this.props.toJSON(),e={audioId:"",audioUrl:t.url};"title"in t&&""!==t.title&&(e.title=t.title),n.tracks.push(e)}),t)},_selectArtwork:function(t){var e=this;return t||(t=l.media({title:r.workflows.selectArtwork.frameTitle,library:{type:"image"},button:{text:r.workflows.selectArtwork.frameButtonText},multiple:!1}),t.uploader.options.uploader.plupload={filters:{mime_types:[{files:r.workflows.selectArtwork.fileTypes,extensions:"jpg,jpeg,gif,png"}]}},t.on("open",function(){var t=this.get("library").get("selection"),i=e.model.get("artworkId"),o=[];i&&(o.push(c.get(i)),o[0].fetch()),t.reset(o)}),t.state("library").on("select",function(){var t=this.get("selection").first().toJSON();e.model.set({artworkId:t.id,artworkUrl:t.sizes.cue.url})}),t)},_selectAudio:function(t){var e=this;return t||(t=new a({title:r.workflows.selectAudio.frameTitle,library:{type:"audio"},button:{text:r.workflows.selectAudio.frameButtonText},multiple:!1}),t.uploader.options.uploader.plupload={filters:{mime_types:[{title:r.workflows.selectAudio.fileTypes,extensions:"m4a,mp3,ogg,wma"}]}},t.state("embed").props.off("change:url",t.state("embed").debouncedScan),t.on("open",function(){var i=this.get("insert").get("selection"),o=e.model.get("audioId"),s=e.model.get("audioUrl"),n=s&&!o,r=[];o&&(r.push(c.get(o)),r[0].fetch()),i.reset(r),n?this.get("embed").props.set({url:s,title:e.model.get("title")}):this.get("embed").props.set({url:"",title:""}),t.setState(n?"embed":"insert")}),t.state("insert").on("insert",function(t){var i=t.first().toJSON().cue,o={},n=s.keys(e.model.attributes);s.without(n,["id","order"]),s.each(n,function(t){var s=e.model.get(t);!s&&t in i&&s!==i[t]&&(o[t]=i[t])}),o.audioId=i.audioId,o.audioUrl=i.audioUrl,e.model.set(o)}),t.state("embed").on("select",function(){var t=this.props.toJSON(),i={};i.audioId="",i.audioUrl=t.url,"title"in t&&""!==t.title&&(i.title=t.title),e.model.set(i)}),t.on("escape",function(){var t=e.model.toJSON();t.artworkUrl||t.audioUrl||e.model.destroy()}),t)}},t.exports=o},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";var o;o=i(4).Model.extend({defaults:{artist:"",artworkId:"",artworkUrl:"",audioId:"",audioUrl:"",format:"",length:"",title:"",order:0}}),t.exports=o},function(t,e,i){"use strict";var o,s=i(1),n=i(2).l10n,r=i(0);o=r.media.view.MediaFrame.Post.extend({createStates:function(){var t=this.options;this.states.add([new r.media.controller.Library({id:"insert",title:this.options.title,priority:20,toolbar:"main-insert",filterable:"uploaded",library:r.media.query(t.library),multiple:!!t.multiple&&"reset",editable:!1,allowLocalEdits:!0,displaySettings:!1,displayUserSettings:!1}),new r.media.controller.Embed({title:n.addFromUrl,menuItem:{text:n.addFromUrl,priority:120},type:"link"})])},bindHandlers:function(){r.media.view.MediaFrame.Select.prototype.bindHandlers.apply(this,arguments),this.on("toolbar:create:main-insert",this.createToolbar,this),this.on("toolbar:create:main-embed",this.mainEmbedToolbar,this);var t={menu:{default:"mainMenu"},content:{embed:"embedContent","edit-selection":"editSelectionContent"},toolbar:{"main-insert":"mainInsertToolbar"}};s.each(t,function(t,e){s.each(t,function(t,i){this.on(e+":render:"+i,this[t],this)},this)},this)},mainInsertToolbar:function(t){var e=this;this.selectionStatusToolbar(t),t.set("insert",{style:"primary",priority:80,text:e.options.button.text,requires:{selection:!0},click:function(){var t=e.state(),i=t.get("selection");e.close(),t.trigger("insert",i).reset()}})},mainEmbedToolbar:function(t){t.view=new r.media.view.Toolbar.Embed({controller:this,text:this.options.button.text})}}),t.exports=o},function(t,e,i){"use strict";var o,s=i(3),n=i(5);o=i(0).Backbone.View.extend({id:"add-tracks",tagName:"p",events:{"click .button":"click"},initialize:function(t){this.l10n=t.l10n},render:function(){var t=s("<a />",{text:this.l10n.addTracks}).addClass("button button-secondary");return this.$el.html(t),this},click:function(t){t.preventDefault(),n.get("addTracks").open()}}),t.exports=o},function(t,e,i){"use strict";var o,s=i(3),n=i(1),r=i(11);o=i(0).Backbone.View.extend({className:"cue-tracklist",tagName:"ol",initialize:function(){this.listenTo(this.collection,"add",this.addTrack),this.listenTo(this.collection,"add remove",this.updateOrder),this.listenTo(this.collection,"reset",this.render)},render:function(){return this.$el.empty(),this.collection.each(this.addTrack,this),this.updateOrder(),this.$el.sortable({axis:"y",delay:150,forceHelperSize:!0,forcePlaceholderSize:!0,opacity:.6,start:function(t,e){e.placeholder.css("visibility","visible")},update:n.bind(function(t,e){this.updateOrder()},this)}),this},addTrack:function(t){var e=new r({model:t});this.$el.append(e.render().el)},updateOrder:function(){n.each(this.$el.find(".cue-track"),function(t,e){var i=s(t).data("cid");this.collection.get(i).set("order",e)},this)}}),t.exports=o},function(t,e,i){"use strict";var o,s=i(3),n=i(12),r=i(13),a=i(0);o=a.Backbone.View.extend({tagName:"li",className:"cue-track",template:a.template("cue-playlist-track"),events:{"change [data-setting]":"updateAttribute","click .js-toggle":"toggleOpenStatus","dblclick .cue-track-title":"toggleOpenStatus","click .js-close":"minimize","click .js-remove":"destroy"},initialize:function(){this.listenTo(this.model,"change:title",this.updateTitle),this.listenTo(this.model,"change",this.updateFields),this.listenTo(this.model,"destroy",this.remove)},render:function(){return this.$el.html(this.template(this.model.toJSON())).data("cid",this.model.cid),this.views.add(".cue-track-column-artwork",new n({model:this.model,parent:this})),this.views.add(".cue-track-audio-group",new r({model:this.model,parent:this})),this},minimize:function(t){t.preventDefault(),this.$el.removeClass("is-open").find("input:focus").blur()},toggleOpenStatus:function(t){t.preventDefault(),this.$el.toggleClass("is-open").find("input:focus").blur(),this.$el.hasClass("is-open")&&s(window).trigger("resize")},updateAttribute:function(t){var e=s(t.target).data("setting"),i=t.target.value;this.model.get(e)!==i&&this.model.set(e,i)},updateFields:function(){var t,e,i=this.model.toJSON(),o=this.$el.find("[data-setting]");for(t in i)e=s("<div/>").html(i[t]).text(),o.filter('[data-setting="'+t+'"]').val(e)},updateTitle:function(){var t=this.model.get("title");this.$el.find(".cue-track-title .text").text(t||"Title")},destroy:function(){this.model.trigger("destroy",this.model)},remove:function(){this.$el.remove()}}),t.exports=o},function(t,e,i){"use strict";var o,s=i(1),n=i(5),r=i(0);o=r.Backbone.View.extend({tagName:"span",className:"cue-track-artwork",template:r.template("cue-playlist-track-artwork"),events:{click:"select"},initialize:function(t){this.parent=t.parent,this.listenTo(this.model,"change:artworkUrl",this.render)},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.parent.$el.toggleClass("has-artwork",!s.isEmpty(this.model.get("artworkUrl"))),this},select:function(){n.setModel(this.model).get("selectArtwork").open()}}),t.exports=o},function(t,e,i){"use strict";var o,s=i(3),n=i(1),r=i(17),a=i(2).settings(),l=i(5),c=i(0);o=c.Backbone.View.extend({tagName:"span",className:"cue-track-audio",template:c.template("cue-playlist-track-audio"),events:{"click .cue-track-audio-selector":"select"},initialize:function(t){this.parent=t.parent,this.listenTo(this.model,"change:audioUrl",this.refresh),this.listenTo(this.model,"destroy",this.cleanup)},render:function(){var t,e,i=this.model.toJSON(),o=this.$el.find(".mejs-audio").attr("id");return""===i.audioUrl&&o&&r.players[o].remove(),this.$el.html(this.template(this.model.toJSON())),(t=this.$el.find(".cue-audio")).length&&(t.wrap("<body></body>"),e={classPrefix:"mejs-",defaultAudioHeight:30,features:["playpause","current","progress","duration"],pluginPath:a.pluginPath,stretching:"responsive",success:n.bind(function(t,e,i){var o=s(i.container).parent();s.nodeName(o.get(0),"body")&&o.replaceWith(o.get(0).childNodes)},this),error:function(t){var e=s(t),i=e.closest(".cue-track"),o=e.closest(".mejs-audio").attr("id");r.players[o].remove(),i.find("audio").remove()}},"m4a"===t.attr("src").split(".").pop()&&(e.pluginVars="isvideo=true"),t.mediaelementplayer(e)),this},refresh:function(t){var e=this.model.toJSON(),i=this.$el.find(".mejs-audio").attr("id"),o=i?r.players[i]:null;o&&""!==e.audioUrl?(o.pause(),o.setSrc(e.audioUrl)):this.render()},cleanup:function(){var t=this.$el.find(".mejs-audio").attr("id"),e=t?r.players[t]:null;e&&e.remove()},select:function(){l.setModel(this.model).get("selectAudio").open()}}),t.exports=o},function(t,e,i){"use strict";var o=i(3),s=i(2),n=i(0);s.data=_cueSettings,s.settings(_cueSettings),n.media.view.settings.post.id=s.data.postId,n.media.view.settings.defaultProps={},s.model.Track=i(7),s.model.Tracks=i(15),s.view.MediaFrame=i(8),s.view.PostForm=i(16),s.view.AddTracksButton=i(9),s.view.TrackList=i(10),s.view.Track=i(11),s.view.TrackArtwork=i(12),s.view.TrackAudio=i(13),s.workflows=i(5),o(function(t){var e;e=s.tracks=new s.model.Tracks(s.data.tracks),delete s.data.tracks,new s.view.PostForm({collection:e,l10n:s.l10n})})},function(t,e,i){"use strict";var o,s=i(1),n=i(4),r=i(2).settings(),a=i(7),l=i(0);o=n.Collection.extend({model:a,comparator:function(t){return parseInt(t.get("order"),10)},fetch:function(){var t=this;return l.ajax.post("cue_get_playlist_tracks",{post_id:r.postId}).done(function(e){t.reset(e)})},save:function(t){return this.sort(),t=s.extend({},t,{post_id:r.postId,tracks:this.toJSON(),nonce:r.saveNonce}),l.ajax.post("cue_save_playlist_tracks",t)}}),t.exports=o},function(t,e,i){"use strict";var o,s=i(3),n=i(9),r=i(10);o=i(0).Backbone.View.extend({el:"#post",saved:!1,events:{"click #publish":"buttonClick","click #save-post":"buttonClick"},initialize:function(t){this.l10n=t.l10n,this.render()},render:function(){return this.views.add("#cue-playlist-editor .cue-panel-body",[new n({collection:this.collection,l10n:this.l10n}),new r({collection:this.collection})]),this},buttonClick:function(t){var e=this,i=s(t.target);return e.saved||this.collection.save().done(function(t){e.saved=!0,i.click()}),e.saved}}),t.exports=o},function(t,e){t.exports=mejs}]);